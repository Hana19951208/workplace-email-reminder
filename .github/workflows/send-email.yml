name: 定时上下班邮件提醒

on:
  schedule:
    # 早上提醒：北京时间 07:45 启动 (UTC 23:45 前一天)
    # 下午提醒：北京时间 17:00 启动 (UTC 09:00)
    # 每天触发，具体是否发送由 Python 脚本内的节假日逻辑判定
    - cron: '45 23 * * *'
    - cron: '0 9 * * *'
  # 允许手动触发测试
  workflow_dispatch:
    inputs:
      email_type:
        description: '邮件类型'
        required: true
        default: 'morning'
        type: choice
        options:
          - morning
          - evening

jobs:
  send-email:
    runs-on: ubuntu-latest
    
    steps:
      - name: 检出代码
        uses: actions/checkout@v4
      
      - name: 设置 Python 环境
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: 安装依赖
        run: pip install -r requirements.txt
      
      - name: 发送邮件
        env:
          SENDER_EMAIL: ${{ secrets.SENDER_EMAIL }}
          SENDER_PASSWORD: ${{ secrets.SENDER_PASSWORD }}
          RECEIVER_EMAIL: ${{ secrets.RECEIVER_EMAIL }}
          AUTO_CHECK: 'true'
          EMAIL_TYPE: ${{ github.event.inputs.email_type || 'morning' }}
        run: python send_email.py
